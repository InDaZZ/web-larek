# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```


# Документация
## MVP

Приложение будет реализовано по принципу MVP архитектуре.

- **Модель (Model)** - Классы Model, хранит данные и бизнес-логику приложения, так же взаимодействуют с потомками - `Product`, `AppState`
- **Вью (View)** - Классы View, отображает данные пользователю, 
реагирует на действия пользователя, так же взаимодействуют с потомками `Card`, `Modal`, `Basket`, `Page`, `Form`, `Success`
- **Презентер (Presenter)** - Классы Presenter, cвязывает модель и вид, 
обрабатывая действия пользователя и обновляя данные в модели, 
так же взаимодействуют с потомками `LarekAPI`, `EventEmitter`, + `src/index.ts`

## Описание базовых классов

Класс `Component<T>`
Базовый абсткратный класс для отображения компонентов, от него наследуются компоненты представления
#### Конструктор:
В конструктор входит один аргумент. класс принимает констурктор: `constructor(container: HTMLElement)` - принимает начальный данные для модели и объект событий для уведомления о изменениях в модели

### Методы: ###
  - `setText`: Устанавливает текст содержимого
  - `setDisable`: Устанавливает статус `Disabled`
  - `setHidden`: Скрывает элемент
  - `setVisible`: Покаызвает элемент
  - `setImage`: Устанавливает изображение с альт. текстом
  - `toggleClass`: Переключает классы элемента
  - `render`: Отображает возвращаемое значение элемента


Класс `EventEmitter`
Класс реализует паттерн "Наблюдатель", позволяет уведомлять и подписываться на события, так же сбрасывать от одного события либо же от всех событий.

### Методы: ###
  - `on`: Подписка на событие
  - `off`: Отписка от события
  - `emit`: Уведомление о событии
  - `onAll`: Подписка на все события
  - `offAll`: Отписка от всех событий


Класс `Api`
Класс обеспечивает обмен данными с сервером, реализует `GET` и `POST` методы
В конструктор входит два аргумента базоый URL (baseURL) и запросы (option) - Если option не передан то используется пустой объект

### Методы: ###
  - `GET`: Забирает данные от сервера
  - `POST`: Отправляет данные на сервер


Класс `Model`
Базовый класс классов бизнес-модели, наследуются Product и AppState. класс принимает констурктор: `constructor(data: Partial<T>, protected events: IEvents)` - принимает начальный данные для модели и объект событий для уведомления о изменениях в модели, содержит метод emitChange, для того чтобы вызывать событие из компонента
#### Конструктор:
В конструктор помещается два аргумента: Частичные данные типа `T` и объект событий `IEvents`. Частичные данные `T` представляют структуру данных, которая используется для инициализации экземпляра класса. Объект `IEvents` содержит определения различных событий, которые могут быть сгенерированы и обработаны внутри класса.

### Методы: ###
  - `emitChange`: используется для уведомления других частей приложения о том, что модель была изменена.


Класс `AppState` Дочерний класс Model. Является моделью приложения и содержит данные о каталоге товаров, корзине, заказе, предпросмотре товара, ошибках формы и методах для управления этими данными. Конструктор класса AppState не принимает аргументов и инициализирует поля класса соответствующими значениями.

Имеет поля catalog: IProduct[] - массив товаров в каталоге.
basket: IProduct[] - массив товаров в корзине.
order: IOrder - информация о заказе.
preview: string | null - идентификатор предпросматриваемого товара.
formErrors: FormError - объект с ошибками формы.

### Методы: ###
updateBasket(): void - обновляет состояние корзины и вызывает соответствующие события.
clearBasket(): void - очищает корзину.
clearOrder(): void - очищает информацию о заказе.
setCatalog(items: IProduct[]): void - устанавливает каталог товаров.
setPreview(item: Product): void - устанавливает предпросматриваемый товар.
getOrderProducts(): IProduct[] - возвращает товары из заказа.
productOrder(item: IProduct): boolean - проверяет, содержится ли товар в заказе.
addToBasket(item: Product): void - добавляет товар в корзину.
removeFromBasket(id: string): void - удаляет товар из корзины.
getTotal(): number - вычисляет общую стоимость заказа.
setPaymentMethod(method: string): void - устанавливает способ оплаты.
setOrderDeliveryField(value: string): void - устанавливает адрес доставки.
setOrderContactField(field: keyof IOrderContacts, value: string): void - устанавливает контактные данные заказа.
validateDelivery(): boolean - валидирует данные о доставке и возвращает результат проверки.
validateContact(): boolean - валидирует контактные данные и возвращает результат проверки.


Класс `Product` наследуется от класса Model<IProduct>. Представляет собой модель продукта в интернет-магазине. Он содержит информацию о продукте, такую как идентификатор, описание, изображение, название, категория и цена.
#### Конструктор:
```constructor(data: IProduct)```
data - объект типа IProduct, содержащий информацию о продукте.

#### Свойства:
id: string - идентификатор продукта.
description: string - описание продукта.
image: string - URL изображения продукта.
title: string - название продукта.
category: string - категория продукта.
price: number - цена продукта.


Класс `Card<T>` представляет компонент карточки товара. Он используется для отображения информации о товаре, включая название, изображение, цену, категорию, описание и кнопки для взаимодействия.
#### Конструктор:
```constructor(blockName: string, container: HTMLElement, action?: ICardAction)```
blockName - строка, указывающая на имя блока (класс CSS) для элементов карточки товара.
container - HTML элемент, в который будет встроен компонент карточки товара.
action - объект типа ICardAction, содержащий действие для кнопки карточки товара (например, обработчик события клика).

#### Свойства:
_title - HTML элемент для отображения названия товара.
_image - HTML элемент для отображения изображения товара.
_category - HTML элемент для отображения категории товара.
_description - HTML элемент для отображения описания товара.
_price - HTML элемент для отображения цены товара.
_button - HTML элемент для отображения кнопки карточки товара.
_buttonModal - HTML элемент для отображения кнопки модального окна.

#### Методы класса:
priceDisabled(value: number | null) - отключает кнопку карточки товара, если цена не указана (null).
set id(value: string) - устанавливает идентификатор товара.
set title(value: string) - устанавливает название товара.
set buttonTitle(value: string) - устанавливает текст на кнопке карточки товара.
set image(value: string) - устанавливает изображение товара.
set price(value: number | null) - устанавливает цену товара.
set category(value: string) - устанавливает категорию товара.
set description(value: string | string[]) - устанавливает описание товара.


Класс `BasketItem` представляет элемент корзины, отображающий информацию о товаре (номер, название, цена) и кнопку для удаления товара из корзины. Он наследует функциональность класса Component<IBasketItem> и добавляет методы для управления отображением информации о товаре.
#### Конструктор
```constructor(container: HTMLElement, index: number, action?: ICardAction)```
container - HTML элемент для отображения элемента корзины.
index - номер товара в корзине.
action - действие, которое будет выполнено при нажатии на кнопку элемента корзины.

#### Свойства
_index: HTMLElement - HTML элемент для отображения номера товара в корзине.
_title: HTMLElement - HTML элемент для отображения названия товара.
_price: HTMLElement - HTML элемент для отображения цены товара.
_button: HTMLButtonElement - HTML кнопка для удаления товара из корзины.

#### Методы
set index(value: number): void - устанавливает значение индекса товара в корзине и обновляет соответствующий элемент DOM.
set title(value: string): void - устанавливает название товара и обновляет соответствующий элемент DOM.
set price(value: number): void - устанавливает цену товара и обновляет соответствующий элемент DOM.


Класс `Basket` является наследником класса Component<IBasketView>. Представляет компонент корзины в интернет-магазине. Он отображает список выбранных товаров, общую стоимость и кнопку для оформления заказа.
#### Конструктор:
```constructor(container: HTMLElement, events: EventEmitter)```
container - HTML элемент, в который будет встроен компонент корзины.
events - экземпляр EventEmitter, используемый для обработки событий.

#### Свойства:
_list: HTMLElement - HTML элемент для отображения списка товаров в корзине.
_total: HTMLElement - HTML элемент для отображения общей стоимости товаров в корзине.
_button: HTMLElement - HTML элемент кнопки оформления заказа.

#### Методы:
disableButton(value: string): void - устанавливает состояние кнопки (активна/неактивна).
set items(items: HTMLElement[]): void - устанавливает список товаров в корзине.
set total(total: number): void - устанавливает общую стоимость товаров в корзине.


Класс `Form<T>` наследник класса Component<IFormState> представляет компонент формы в интерфейсе. Он обеспечивает взаимодействие с формой, включая обработку ввода данных, валидацию и отправку данных.
#### Констурктор
```constructor(container: HTMLFormElement, events: IEvents)```
container - HTML элемент формы.
events - экземпляр IEvents, используемый для обработки событий.

#### Свойства
_submit: HTMLButtonElement - HTML элемент кнопки отправки формы.
_errors: HTMLElement - HTML элемент для отображения ошибок валидации формы.

#### Методы
onInputChange(field: keyof T, value: string): void - обработчик изменения значения в поле формы.
set valid(value: boolean): void - устанавливает состояние кнопки отправки формы (активна/неактивна).
set errors(value: string): void - устанавливает текст ошибки валидации формы.
render(state: Partial<T> & IFormState): HTMLElement - обновляет состояние формы и возвращает HTML элемент формы.


Класс `Modal` представляет модальное окно в интерфейсе. Он обеспечивает отображение контента в модальном окне, управление его открытием и закрытием, а также возможность передачи данных через события.
#### Констурктор
```constructor(container: HTMLElement, events: IEvents)```
container - HTML элемент модального окна.
events - экземпляр IEvents, используемый для обработки событий.

#### Свойства
_closeButton: HTMLButtonElement - HTML кнопка для закрытия модального окна.
_content: HTMLElement - HTML элемент для отображения контента в модальном окне.

#### Методы
set content(value: HTMLElement): void - устанавливает контент в модальном окне.
open(): void - открывает модальное окно.
close(): void - закрывает модальное окно.
render(data: IModalData): HTMLElement - обновляет состояние модального окна и открывает его.


Класс `Page` представляет страницу интерфейса. Имеет наследника Component<IPage>. Он содержит элементы страницы, такие как счетчик товаров в корзине, каталог товаров, обертку страницы и элемент корзины, и обеспечивает их отображение и взаимодействие с помощью событий.
#### Конструктор
``` constructor(container: HTMLElement, events: IEvents)```
container - HTML элемент страницы.
events - экземпляр IEvents, используемый для обработки событий.

#### Свойства
_counter: HTMLElement - HTML элемент для отображения счетчика товаров в корзине.
_catalog: HTMLElement - HTML элемент для отображения каталога товаров.
_wrapper: HTMLElement - HTML элемент для обертки контента страницы.
_basket: HTMLElement - HTML элемент для отображения корзины.

#### Методы
set counter(value: number): void - устанавливает значение счетчика товаров в корзине.
set catalog(items: HTMLElement[]): void - устанавливает список товаров в каталоге.
set locked(value: boolean): void - блокирует или разблокирует страницу.


Класс `Success` представляет компонент для отображения сообщения об успешном завершении операции. Он содержит элементы для отображения общей информации об успешной операции и кнопку для закрытия сообщения.
#### Конструктор
```constructor(container: HTMLElement, actions: ISuccessActions)```
container - HTML элемент для отображения компонента.
actions - объект с действиями, которые можно выполнить после успешной операции.

#### Свойства
_close: HTMLElement - HTML элемент кнопки закрытия сообщения.
_total: HTMLElement - HTML элемент для отображения общей цены об успешной операции.

#### Методы
setText(element: HTMLElement, text: string): void - устанавливает текстовое содержимое элемента DOM.


Класс `LarekAPI` наследует класс `Api` и имплементирует интерфейс ILarekAPI, реализует обмен данными с севрером и его моделей данных. принимает список товаров, получить карточку, и отправить заказ

### Методы: ###
  - `getProduct (id: string): Promise<IProduct>`: Отправляет запрос на сервер для получения информации о продукте с указанным идентификатором
  - `getProductList (): Promise<IProduct[]>`: Отправляет запрос на сервер для получения списка всех товаров
  - `orderProduct (order: IOrder): Promise<IOrderResult>`: Отправляет запрос на сервер для оформления заказа с указанными данными


Класс `Order` представляет форму для оформления заказа. Он наследует функциональность класса Form<IOrderDeliveryForm> и добавляет методы для управления выбором способа оплаты и установки адреса доставки.
#### Конструктор
```constructor(container: HTMLFormElement, events: IEvents)```
container - HTML форма для оформления заказа.
events - экземпляр IEvents, используемый для обработки событий.
#### Свойства
_paymentContainer: HTMLDivElement - контейнер для отображения кнопок выбора способа оплаты.
_paymentButton: HTMLButtonElement[] - массив кнопок выбора способа оплаты.

#### Методы
setToggleClassPayment(className: string): void - устанавливает активный класс для кнопки выбора способа оплаты.
set address(value: string): void - устанавливает значение поля адреса доставки в форме.


Класс `Contacts` представляет форму для ввода контактной информации (телефона и email) при оформлении заказа. Он наследует функциональность класса Form<IOrderContacts> и добавляет методы для установки значений полей телефона и email.
#### Конструктор
```constructor(container: HTMLFormElement, events: IEvents)```
container - HTML форма для ввода контактной информации.
events - экземпляр IEvents, используемый для обработки событий.

#### Методы
set phone(value: string): void - устанавливает значение поля телефона в форме.
set email(value: string): void - устанавливает значение поля email в форме.

## Компоненты 

Наследники класса `Component` - `Card.`, `Modal.`, `Basket.`, `Page.`, `Form.`, `Success.`. Используются для визуализации компонентов. Каждый из этих компонентов выполняет определенную функцию в пользовательском интерфейсе.

## Типы данных

```typescript

export type PaymentMethods = 'card' | 'cash' | '';
export type Categorytype = 'софт-скилл' | 'хард-скилл' | 'другое' | 'кнопка' | 'доп';

/*
  * Интерфейс, указывающий возвращаемые данные карточки
  **/
interface IProduct {
  // ID продукта
  id: string;
  // Категория товара
  categoty: string;
  // Описание товара
  description: string;
  // Ссылка на картинку
  image: string;
  // Название
  title: string;
  // Категория товара
  category: CategoryType;
  // Цена товара, может быть null
  price: number | null;
}

/*
  * Интерфейс, для хранения актуального состояния приложения
    Используется для хранения карточек, корзины, заказа пользователя, ошибок
    в формах
  **/
interface IAppState {
  // Массив карточек товара
  catalog: IProduct[];
  // Информация о заказе при покупке товара
  order: IOrder || null;
  // Корзина с товарами
  basket: IProduct[] | null;
  // Предосмотр товара
  preview: string | null
}

/*
  * Интерфейс, описывающий карточку товара
  **/
interface ICard {
  id: string;
  title: string;
  category: string;
  description: string;
  image: string;
  price: number | null;
  selected: boolean;
}

/*
  * Интерфейс описывающий страницу
  **/
interface IPage {
  // Счётчик товаров в корзине
  counter: number;
  // Массив карточек с товарвми
  store: HTMLElement[];
  // Булево значение отключает прокрутку страницы при открытом окошке
  locked: boolean;
}

/*
  * Интерфейс, описывающий корзину товаров
  **/
interface IBasket {
  // Массив элементов с товаром
  list: HTMLElement[];
  // Общая цена товаров
  price: number;
}

/*
  * Интерфейс, поля для ввода адреса и метот оплаты
  * */
interface IOrderDeliveryForm {
  // Адрес
  address: string;
  // Способ оплаты
  payment: string;
}

/*
  * Интерфейс, полей для ввода контактов
  * */
interface IOrderContacts {
  // Телефон
  phone: string;
  // Почта
  email: string;
}

/**
  * Интерйфейс форм 
  **/
interface IOrderFormError extends IOrderContacts, IOrderDeliveryForm {}


/*
* Интерфейс, описывающий поля заказа товара и объеденяющий поля
**/
interface IOrder extends IOrderFormError {
  // Массив ID купленных товаров
  items: string[];
  // Сумма заказа
  total: number;
}

/*
  * Интерфейс описывающий оформление заказа
  **/
interface IOrderSuccess {
  // ID заказа
  id: string;
  // Сумма заказа
  total: number;
}

/*
  * Тип, описывающий ошибки валидации форм
  **/
type FormErrors = Partial<Record<keyof IOrder, string>>;

```

## События:

``` typescript
items:changed - вызывается при изменении списка товаров в каталоге.
basket:open - вызывается при открытии корзины.
card:select - вызывается при выборе товара для просмотра подробной информации.
basket:changed - вызывается при изменении содержимого корзины и ее общей стоимости.
counter:changed - вызывается при изменении количества товаров в корзине.
product:add - вызывается при добавлении товара в корзину.
product:delete - вызывается при удалении товара из корзины.
preview:changed - вызывается при отображении предварительной информации о товаре перед добавлением в корзину.
order:open - вызывается при открытии модального окна для оформления заказа.
order.payment:change - вызывается при изменении способа оплаты в форме заказа.
order.address:change - вызывается при изменении поля адреса в форме заказа.
deliveryFormError:change - вызывается при изменении ошибок валидации формы доставки.
order:submit - вызывается при попытке отправки формы заказа.
contacts.<field>:change - вызывается при изменении полей контактной информации в форме заказа.
contactFormError:change - вызывается при изменении ошибок валидации формы контактной информации.
contacts:submit - вызывается при попытке отправки формы контактной информации.
modal:open - вызывается при открытии модального окна.
modal:close - вызывается при закрытии модального окна.
```